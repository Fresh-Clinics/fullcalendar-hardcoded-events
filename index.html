<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FullCalendar with Hardcoded Events</title>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.15/index.global.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.15/index.global.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<div id="calendar"></div>

<script>
$(document).ready(function () {
    console.log("Initializing FullCalendar with Hardcoded Events...");

    // Load JSON data for events and start times
    Promise.all([
        fetch('simplybook_events.json').then(response => response.json()),
        fetch('simplybook_start_times.json').then(response => response.json())
    ])
    .then(([eventData, startTimeData]) => {
        console.log("Loaded event data:", eventData);
        console.log("Loaded start time data:", startTimeData);

        // Process the fetched data to create events for FullCalendar
        const events = processEvents(eventData, startTimeData);

        // Initialize FullCalendar with processed events
        initializeCalendar(events);
    })
    .catch(error => console.error("Error loading JSON data:", error));

    // Process events to create the start and end times
    function processEvents(eventData, startTimeData) {
        const events = [];
        startTimeData.forEach(startTimeEntry => {
            const serviceId = startTimeEntry.service_id;
            const event = eventData.find(e => e.id === serviceId.toString());

            if (event) {
                Object.entries(startTimeEntry.timeslots).forEach(([date, times]) => {
                    times.forEach(time => {
                        const startDateTime = new Date(`${date}T${time}`);
                        const durationMinutes = parseInt(event.duration, 10);
                        const endDateTime = new Date(startDateTime.getTime() + durationMinutes * 60000);

                        events.push({
                            id: event.id,
                            title: event.name,
                            start: startDateTime.toISOString(),
                            end: endDateTime.toISOString(),
                            description: event.description || '',
                            resourceId: startTimeEntry.provider_id,
                            category: event.categories[0] || 'default',
                        });

                        console.log(`Creating event for ${event.name} (${event.id}) starting at ${startDateTime.toISOString()} and ending at ${endDateTime.toISOString()}`);
                    });
                });
            }
        });

        console.log("Processed events for calendar:", events);
        return events;
    }

    // Initialize FullCalendar with the events
    function initializeCalendar(events) {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            schedulerLicenseKey: 'CC-Attribution-NonCommercial-NoDerivatives',
            initialView: 'resourceTimeGridDay',
            initialDate: '2024-10-29',
            timeZone: 'Australia/Sydney', // Set timezone to AEST
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'resourceTimeGridDay,timeGridWeek,dayGridMonth'
            },
            resources: getHardcodedResources(),
            events: events,
            slotMinTime: '07:00',
            slotMaxTime: '23:00',
            resourceOrder: 'order_id',
            businessHours: [
                {
                    daysOfWeek: [2],
                    startTime: '09:00',
                    endTime: '18:30'
                },
                {
                    daysOfWeek: [3],
                    startTime: '07:30',
                    endTime: '19:00'
                },
                {
                    daysOfWeek: [4],
                    startTime: '07:00',
                    endTime: '22:30'
                }
            ],
            allDaySlot: false
        });

        calendar.render();
    }

    function getHardcodedResources() {
        return [
            { id: '29', title: 'Woodlands Stage', category: 'Program', order_id: 'a' },
            { id: '30', title: 'Fresh Lounge', category: 'Program', order_id: 'b' },
            // Add more resources as needed...
        ];
    }
});
</script>
</body>
</html>
